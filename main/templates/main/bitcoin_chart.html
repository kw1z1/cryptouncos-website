{% extends 'main/layout.html' %}
{% load static %}

{% block title %}–ì—Ä–∞—Ñ–∏–∫ BTC ‚Ä¢ CryptoUncos{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="color: #fff; font-size: 2.5rem;">BITCOIN LIVE CHART</h1>
        <p style="color: #ccc;">–ì—Ä–∞—Ñ–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å AI –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏</p>
    </div>

    <!-- –¶–µ–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ -->
    <div id="priceBox" style="background: #1a1a1a; border: 1px solid #e6007a; border-radius: 12px; padding: 1.5rem; text-align: center; margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
            <span style="font-size: 2rem;">‚Çø</span>
            <span id="btcPrice" style="font-size: 2.5rem; font-weight: bold; color: #fff;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω—ã...</span>
            <span id="btcChange" style="padding: 0.5rem 1rem; border-radius: 20px; font-weight: bold;">--%</span>
        </div>
        <div style="display: flex; justify-content: center; gap: 2rem; color: #ccc; flex-wrap: wrap;">
            <div>–ú–∞–∫—Å 24—á: <span id="high24h">--</span></div>
            <div>–ú–∏–Ω 24—á: <span id="low24h">--</span></div>
            <div>–û–±—ä–µ–º: <span id="volume24h">--</span></div>
        </div>
    </div>

    <!-- –¢–∞–π–º—Ñ—Ä–µ–π–º—ã -->
    <div style="display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
        <button onclick="changeTimeframe('1m')" class="timeframe-btn active">1 –º–∏–Ω</button>
        <button onclick="changeTimeframe('5m')" class="timeframe-btn">5 –º–∏–Ω</button>
        <button onclick="changeTimeframe('15m')" class="timeframe-btn">15 –º–∏–Ω</button>
        <button onclick="changeTimeframe('1h')" class="timeframe-btn">1 —á–∞—Å</button>
        <button onclick="changeTimeframe('4h')" class="timeframe-btn">4 —á–∞—Å–∞</button>
        <button onclick="changeTimeframe('1d')" class="timeframe-btn">1 –¥–µ–Ω—å</button>
    </div>

    <!-- –ü—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ -->
    <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1rem; margin-bottom: 2rem;">
        <canvas id="myChart" width="800" height="400"></canvas>
    </div>

    <!-- AI –ø—Ä–æ–≥–Ω–æ–∑ -->
    <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
        <h3 style="color: #fff; text-align: center; margin-bottom: 1rem;">ü§ñ AI –ü–†–û–ì–ù–û–ó –¶–ï–ù–´</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <!-- –¢–µ–∫—É—â–∏–π –∞–Ω–∞–ª–∏–∑ -->
            <div>
                <h4 style="color: #e6007a; margin-bottom: 1rem;">üìä –ê–ù–ê–õ–ò–ó –†–´–ù–ö–ê</h4>
                <div style="color: #ccc; line-height: 1.6;">
                    <div>–°–∏–≥–Ω–∞–ª: <span id="signal" style="color: #00ff88; font-weight: bold;">–ê–ù–ê–õ–ò–ó...</span></div>
                    <div>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: <span id="confidence">--%</span></div>
                    <div>–¢—Ä–µ–Ω–¥: <span id="trend">--</span></div>
                    <div>–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: <span id="volatility">--</span></div>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–≥–Ω–æ–∑ -->
            <div>
                <h4 style="color: #e6007a; margin-bottom: 1rem;">‚è∞ –ü–†–û–ì–ù–û–ó –ù–ê <span id="timeframeLabel">1 –ß–ê–°</span></h4>
                <div style="color: #ccc; line-height: 1.6;">
                    <div>–ü—Ä–æ–≥–Ω–æ–∑ —Ü–µ–Ω—ã: <span id="predictedPrice" style="color: #00ff88; font-weight: bold;">--</span></div>
                    <div>–ò–∑–º–µ–Ω–µ–Ω–∏–µ: <span id="potentialChange">--</span></div>
                    <div>–ü–µ—Ä–∏–æ–¥: <span id="timeFrame">60 –º–∏–Ω—É—Ç</span></div>
                    <div>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: <span id="recommendation" style="font-weight: bold;">--</span></div>
                </div>
            </div>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏–µ -->
        <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #333;">
            <div id="actionBox" style="display: inline-block; padding: 1rem 2rem; background: #333; border-radius: 8px;">
                <span style="font-weight: bold; color: #fff;">–î–ï–ô–°–¢–í–ò–ï: </span>
                <span id="action" style="font-weight: bold;">–û–ñ–ò–î–ê–ù–ò–ï –î–ê–ù–ù–´–•...</span>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div style="display: flex; gap: 1rem; justify-content: center;">
        <button onclick="buyBTC()" style="padding: 1rem 2rem; background: #00ff88; border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; font-size: 1.1rem;">
            üìà –ö–£–ü–ò–¢–¨ BTC
        </button>
        <button onclick="sellBTC()" style="padding: 1rem 2rem; background: #ff4444; border: none; border-radius: 8px; color: #fff; font-weight: bold; cursor: pointer; font-size: 1.1rem;">
            üìâ –ü–†–û–î–ê–¢–¨ BTC
        </button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentPrice = 0;
let priceHistory = [];
let chart;
let currentTimeframe = '1h'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —á–∞—Å
let lastUpdateTime = 0;

// –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
const style = document.createElement('style');
style.textContent = `
    .timeframe-btn {
        padding: 0.5rem 1rem;
        background: rgba(255,255,255,0.05);
        border: 1px solid #333;
        border-radius: 6px;
        color: #ccc;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Space Mono', monospace;
    }
    .timeframe-btn:hover {
        border-color: #e6007a;
        color: #fff;
    }
    .timeframe-btn.active {
        background: #e6007a;
        color: #fff;
        border-color: #e6007a;
    }
`;
document.head.appendChild(style);

// –°–º–µ–Ω–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
function changeTimeframe(timeframe) {
    currentTimeframe = timeframe;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–π–±–ª
    const timeframeLabels = {
        '1m': '1 –ú–ò–ù–£–¢–£',
        '5m': '5 –ú–ò–ù–£–¢', 
        '15m': '15 –ú–ò–ù–£–¢',
        '1h': '1 –ß–ê–°',
        '4h': '4 –ß–ê–°–ê',
        '1d': '1 –î–ï–ù–¨'
    };
    document.getElementById('timeframeLabel').textContent = timeframeLabels[timeframe];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑
    if (priceHistory.length > 0) {
        generateAIPrediction(priceHistory[priceHistory.length - 1].change);
    }
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
async function loadRealBitcoinData() {
    const now = Date.now();
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 3 —Å–µ–∫—É–Ω–¥—ã
    if (now - lastUpdateTime < 3000) {
        return;
    }
    lastUpdateTime = now;
    
    try {
        console.log('Loading real Bitcoin data...');
        
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true&include_24hr_high=true&include_24hr_low=true&include_market_cap=true');
        
        if (!response.ok) {
            throw new Error('API response not OK');
        }
        
        const data = await response.json();
        console.log('Real data received:', data);
        
        const btc = data.bitcoin;
        const newPrice = btc.usd;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
        if (newPrice !== currentPrice) {
            currentPrice = newPrice;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
            document.getElementById('btcPrice').textContent = '$' + currentPrice.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã
            const changeElement = document.getElementById('btcChange');
            const changeText = (btc.usd_24h_change > 0 ? '+' : '') + btc.usd_24h_change.toFixed(2) + '%';
            changeElement.textContent = changeText;
            changeElement.style.background = btc.usd_24h_change >= 0 ? 'rgba(0,255,136,0.2)' : 'rgba(255,68,68,0.2)';
            changeElement.style.color = btc.usd_24h_change >= 0 ? '#00ff88' : '#ff4444';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('high24h').textContent = '$' + btc.usd_24h_high.toLocaleString('ru-RU', {maximumFractionDigits: 0});
            document.getElementById('low24h').textContent = '$' + btc.usd_24h_low.toLocaleString('ru-RU', {maximumFractionDigits: 0});
            document.getElementById('volume24h').textContent = '$' + (btc.usd_24h_vol / 1000000000).toFixed(1) + ' –º–ª—Ä–¥';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Ü–µ–Ω
            priceHistory.push({
                price: currentPrice,
                timestamp: new Date(),
                change: btc.usd_24h_change
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            if (priceHistory.length > 100) {
                priceHistory = priceHistory.slice(-100);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
            updateChart();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º AI –ø—Ä–æ–≥–Ω–æ–∑
            generateAIPrediction(btc.usd_24h_change);
            
            console.log('Data updated successfully');
        }
        
    } catch (error) {
        console.error('Error loading real data:', error);
        useFallbackData();
    }
}

// –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
function useFallbackData() {
    console.log('Using fallback data');
    
    // –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ Bitcoin
    const newPrice = 112500 + (Math.random() - 0.5) * 2000; // –°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ
    if (Math.abs(newPrice - currentPrice) > 50) {
        currentPrice = newPrice;
        
        // –°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        const change = (Math.random() - 0.5) * 8; // ¬±4%
        const changePercent = parseFloat(change.toFixed(2));
        
        document.getElementById('btcPrice').textContent = '$' + currentPrice.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        const changeElement = document.getElementById('btcChange');
        changeElement.textContent = (changePercent > 0 ? '+' : '') + changePercent + '%';
        changeElement.style.background = changePercent >= 0 ? 'rgba(0,255,136,0.2)' : 'rgba(255,68,68,0.2)';
        changeElement.style.color = changePercent >= 0 ? '#00ff88' : '#ff4444';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('high24h').textContent = '$' + Math.round(currentPrice * 1.03).toLocaleString('ru-RU');
        document.getElementById('low24h').textContent = '$' + Math.round(currentPrice * 0.97).toLocaleString('ru-RU');
        document.getElementById('volume24h').textContent = '$' + (35 + Math.random() * 10).toFixed(1) + ' –º–ª—Ä–¥';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        priceHistory.push({
            price: currentPrice,
            timestamp: new Date(),
            change: changePercent
        });
        
        if (priceHistory.length > 100) {
            priceHistory = priceHistory.slice(-100);
        }
        
        updateChart();
        generateAIPrediction(changePercent);
    }
}

// –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
function createChart() {
    const ctx = document.getElementById('myChart').getContext('2d');
    
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'BTC Price',
                data: [],
                borderColor: '#e6007a',
                backgroundColor: 'rgba(230, 0, 122, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(13, 2, 8, 0.9)',
                    borderColor: '#e6007a',
                    borderWidth: 1,
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    callbacks: {
                        label: function(context) {
                            return '–¶–µ–Ω–∞: $' + context.parsed.y.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    },
                    ticks: {
                        color: '#fff',
                        maxTicksLimit: 8
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    },
                    ticks: {
                        color: '#fff',
                        callback: function(value) {
                            return '$' + value.toLocaleString('ru-RU', {maximumFractionDigits: 0});
                        }
                    }
                }
            }
        }
    });
}

// –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
function updateChart() {
    if (!chart) return;
    
    const now = new Date();
    const timeLabel = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
    
    chart.data.labels.push(timeLabel);
    chart.data.datasets[0].data.push(currentPrice);
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫
    if (chart.data.labels.length > 20) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }
    
    chart.update('none');
}

// –£–º–Ω—ã–π AI –ø—Ä–æ–≥–Ω–æ–∑ —Å —É—á–µ—Ç–æ–º —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
function generateAIPrediction(currentChange) {
    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ü–µ–Ω –¥–ª—è –ª—É—á—à–µ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞
    const recentPrices = priceHistory.slice(-10).map(p => p.price);
    const avgPrice = recentPrices.reduce((a, b) => a + b, 0) / recentPrices.length;
    const priceMomentum = currentPrice > avgPrice ? 1 : -1;
    
    // –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    const volatility = calculateVolatility(recentPrices);
    
    // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
    const timeframeMultipliers = {
        '1m': 0.02,   // 2% –æ—Ç —á–∞—Å–æ–≤–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞
        '5m': 0.08,   // 8%  
        '15m': 0.25,  // 25%
        '1h': 1,      // 100% (–±–∞–∑–æ–≤—ã–π)
        '4h': 2.5,    // 250%
        '1d': 8       // 800%
    };
    
    const multiplier = timeframeMultipliers[currentTimeframe] || 1;
    
    // –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1 —á–∞—Å
    let basePredictedChange, signal, confidence, recommendation;
    
    if (currentChange > 3 && priceMomentum > 0) {
        // –°–∏–ª—å–Ω—ã–π –±—ã—á–∏–π —Ç—Ä–µ–Ω–¥
        basePredictedChange = 0.8 + (Math.random() * 1.2);
        signal = '–°–ò–õ–¨–ù–´–ô –†–û–°–¢ üöÄ';
        confidence = '82%';
        recommendation = '–°–ò–õ–¨–ù–ê–Ø –ü–û–ö–£–ü–ö–ê';
    } else if (currentChange > 1 && priceMomentum > 0) {
        // –ë—ã—á–∏–π —Ç—Ä–µ–Ω–¥
        basePredictedChange = 0.3 + (Math.random() * 0.7);
        signal = '–†–û–°–¢ üìà';
        confidence = '75%';
        recommendation = '–ü–û–ö–£–ü–ö–ê';
    } else if (currentChange < -3 && priceMomentum < 0) {
        // –°–∏–ª—å–Ω—ã–π –º–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥
        basePredictedChange = -1.0 - (Math.random() * 1.5);
        signal = '–°–ò–õ–¨–ù–û–ï –ü–ê–î–ï–ù–ò–ï üîª';
        confidence = '78%';
        recommendation = '–°–ò–õ–¨–ù–ê–Ø –ü–†–û–î–ê–ñ–ê';
    } else if (currentChange < -1 && priceMomentum < 0) {
        // –ú–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥
        basePredictedChange = -0.4 - (Math.random() * 0.6);
        signal = '–ü–ê–î–ï–ù–ò–ï üìâ';
        confidence = '70%';
        recommendation = '–ü–†–û–î–ê–ñ–ê';
    } else {
        // –ë–æ–∫–æ–≤–æ–π —Ç—Ä–µ–Ω–¥
        basePredictedChange = (Math.random() - 0.5) * 0.8;
        signal = '–ë–û–ö–û–í–ò–ö ‚ö°';
        confidence = '65%';
        recommendation = Math.random() > 0.5 ? '–£–î–ï–†–ñ–ò–í–ê–¢–¨' : '–ñ–î–ê–¢–¨';
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
    const predictedChange = basePredictedChange * multiplier;
    const predictedPrice = currentPrice * (1 + predictedChange / 100);
    
    // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –¥–ª—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
    const timeframePeriods = {
        '1m': '1 –º–∏–Ω—É—Ç—É',
        '5m': '5 –º–∏–Ω—É—Ç', 
        '15m': '15 –º–∏–Ω—É—Ç',
        '1h': '1 —á–∞—Å',
        '4h': '4 —á–∞—Å–∞',
        '1d': '1 –¥–µ–Ω—å'
    };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    document.getElementById('signal').textContent = signal;
    document.getElementById('confidence').textContent = confidence;
    document.getElementById('trend').textContent = priceMomentum > 0 ? '–í–û–°–•–û–î–Ø–©–ò–ô' : '–ù–ò–°–•–û–î–Ø–©–ò–ô';
    document.getElementById('volatility').textContent = volatility.toFixed(1) + '%';
    
    document.getElementById('predictedPrice').textContent = '$' + predictedPrice.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    document.getElementById('potentialChange').textContent = (predictedChange > 0 ? '+' : '') + predictedChange.toFixed(2) + '%';
    document.getElementById('timeFrame').textContent = timeframePeriods[currentTimeframe];
    document.getElementById('recommendation').textContent = recommendation;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
    const actionElement = document.getElementById('action');
    actionElement.textContent = recommendation;
    actionElement.style.color = recommendation.includes('–ü–û–ö–£–ü–ö–ê') ? '#00ff88' : 
                               recommendation.includes('–ü–†–û–î–ê–ñ–ê') ? '#ff4444' : '#e6007a';
    
    const actionBox = document.getElementById('actionBox');
    actionBox.style.background = recommendation.includes('–ü–û–ö–£–ü–ö–ê') ? 'rgba(0,255,136,0.2)' :
                                recommendation.includes('–ü–†–û–î–ê–ñ–ê') ? 'rgba(255,68,68,0.2)' : 'rgba(230,0,122,0.2)';
    actionBox.style.border = recommendation.includes('–ü–û–ö–£–ü–ö–ê') ? '1px solid #00ff88' :
                            recommendation.includes('–ü–†–û–î–ê–ñ–ê') ? '1px solid #ff4444' : '1px solid #e6007a';
}

// –†–∞—Å—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
function calculateVolatility(prices) {
    if (prices.length < 2) return 2.0;
    
    const returns = [];
    for (let i = 1; i < prices.length; i++) {
        returns.push((prices[i] - prices[i-1]) / prices[i-1]);
    }
    
    const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
    const variance = returns.reduce((a, b) => a + Math.pow(b - avgReturn, 2), 0) / returns.length;
    const stdDev = Math.sqrt(variance);
    
    return stdDev * 100; // –í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
}

// –¢–æ—Ä–≥–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function buyBTC() {
    const signal = document.getElementById('recommendation').textContent;
    const predicted = document.getElementById('predictedPrice').textContent;
    alert(`‚úÖ –ó–ê–Ø–í–ö–ê –ù–ê –ü–û–ö–£–ü–ö–£ –í–´–ü–û–õ–ù–ï–ù–ê!\n\n–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $${currentPrice.toLocaleString('ru-RU')}\n–ü—Ä–æ–≥–Ω–æ–∑: ${predicted}\n–°–∏–≥–Ω–∞–ª: ${signal}\n\n–û—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!`);
}

function sellBTC() {
    const signal = document.getElementById('recommendation').textContent;
    const predicted = document.getElementById('predictedPrice').textContent;
    alert(`‚úÖ –ó–ê–Ø–í–ö–ê –ù–ê –ü–†–û–î–ê–ñ–£ –í–´–ü–û–õ–ù–ï–ù–ê!\n\n–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $${currentPrice.toLocaleString('ru-RU')}\n–ü—Ä–æ–≥–Ω–æ–∑: ${predicted}\n–°–∏–≥–Ω–∞–ª: ${signal}\n\n–û—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!`);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing Bitcoin chart...');
    createChart();
    loadRealBitcoinData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    setInterval(loadRealBitcoinData, 5000);
});
</script>
{% endblock %}